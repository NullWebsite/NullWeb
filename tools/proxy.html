<!DOCTYPE html>
<html>
<head>
  <title>üïµÔ∏è NullSW Proxy</title>
  <meta charset="UTF-8">
  <style>
    body { font-family: sans-serif; padding: 1em; }
    input, button { font-size: 1em; padding: 0.5em; }
    iframe { width: 100%; height: 90vh; border: none; margin-top: 1em; }
  </style>
</head>
<body>
  <h1>üõ†Ô∏è Null Service Worker Proxy</h1>
  <p>Enter a full URL to proxy:</p>
  <input id="targetUrl" placeholder="https://example.com">
  <button onclick="load()">Proxy Load</button>
  <iframe id="frame"></iframe>

  <script>
    // Register the service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('proxy.html')
        .then(() => console.log('[SW] Registered'))
        .catch(err => console.error('[SW] Failed', err));
    }

    function load() {
      const url = document.getElementById('targetUrl').value;
      const proxied = location.origin + '/proxy/' + btoa(url);
      document.getElementById('frame').src = proxied;
    }
  </script>

  <script id="sw" type="javascript/worker">
    self.addEventListener('fetch', event => {
      const url = new URL(event.request.url);

      if (url.pathname.startsWith('/proxy/')) {
        const encoded = url.pathname.split('/proxy/')[1];
        let target;
        try {
          target = atob(encoded);
        } catch (e) {
          return event.respondWith(new Response('Bad encoding', { status: 400 }));
        }

        event.respondWith(fetch(target, {
          method: event.request.method,
          headers: event.request.headers,
          body: event.request.body,
          redirect: 'follow'
        }));
      }
    });
  </script>

  <script>
    // Inject the SW inline (cheeky trick to keep it all in one file)
    const blob = new Blob([document.getElementById('sw').textContent], { type: 'text/javascript' });
    const blobURL = URL.createObjectURL(blob);
    navigator.serviceWorker.register(blobURL);
  </script>
</body>
</html>