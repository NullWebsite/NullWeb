<!DOCTYPE html>
<html>
<head>
  <title>Pr*xy ‚Ä¢ NullTools</title>
  <meta charset="UTF-8">
  <style>
    body { font-family: sans-serif; padding: 1em; background: #111; color: #0f0; }
    input, button { font-size: 1em; padding: 0.5em; background: #000; color: #0f0; border: 1px solid #0f0; }
    iframe { width: 100%; height: 80vh; border: 2px solid #0f0; margin-top: 1em; }
    .log { margin-top: 1em; font-size: 0.9em; color: #0f0; white-space: pre-wrap; background: #000; padding: 1em; border: 1px solid #0f0; }
  </style>
</head>
<body>
  <h1>üõ†Ô∏è Null Pr*xy Debug</h1>
  <p>Enter a full URL to proxy (must include https://):</p>
  <input id="targetUrl" placeholder="https://example.com">
  <button onclick="load()">Proxy Load</button>
  <div class="log" id="log">[Waiting for input]</div>
  <iframe id="frame"></iframe>

  <script>
    const logBox = document.getElementById("log");
    const frame = document.getElementById("frame");

    function log(msg) {
      logBox.textContent += "\n" + msg;
    }

    // Detect iOS
    const isiOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    if (isiOS) {
      log("‚ö†Ô∏è iOS browser detected ‚Äî service workers may not work!");
    }

    // Register the SW from sw.js
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(reg => {
        log("‚úÖ Service worker registered: sw.js");
      }).catch(err => {
        log("‚ùå Service worker registration failed:\n" + err);
      });
    } else {
      log("‚ùå This browser does not support service workers.");
    }

    function load() {
      const url = document.getElementById("targetUrl").value.trim();
      if (!url.startsWith("https://")) {
        alert("URL must start with https://");
        return;
      }

      const encoded = btoa(url);
      const proxyUrl = location.origin + "/proxy/" + encoded;

      log("üîÅ Attempting to load:\n" + proxyUrl);

      frame.src = proxyUrl;

      // Timeout to detect 404 fallback
      setTimeout(() => {
        fetch(proxyUrl, { method: "HEAD" })
          .then(res => {
            if (res.status === 404) {
              log("‚ö†Ô∏è 404 error ‚Äî service worker may not be intercepting.\nPossible causes:\n‚Ä¢ iOS browser limitation\n‚Ä¢ Service worker not active\n‚Ä¢ Path misconfigured\n‚Ä¢ You're not testing on a supported browser");
            } else {
              log("‚úÖ Target fetched ‚Äî looks like it's working!");
            }
          }).catch(err => {
            log("‚ùå Error checking proxied URL:\n" + err);
          });
      }, 2000);
    }
  </script>
</body>
</html>